<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Open Account - Oakline Bank</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>Open a New Account</h2>

    <form id="openAccountForm">
      <label for="accountType">Account Type:</label>
      <select id="accountType" required>
        <option value="">Select account type</option>
        <option value="Checking">Checking</option>
        <option value="Savings">Savings</option>
      </select>

      <label for="initialDeposit">Initial Deposit ($):</label>
      <input type="number" id="initialDeposit" min="0" required />

      <label for="fullName">Full Name:</label>
      <input type="text" id="fullName" required />

      <label for="dob">Date of Birth:</label>
      <input type="date" id="dob" required />

      <label for="address">Address:</label>
      <input type="text" id="address" required />

      <button type="submit">Create Account</button>
    </form>

    <div id="accountResult" class="result-box" style="display:none;">
      <h3>✅ Account Created</h3>
      <p><strong>Account Number:</strong> <span id="accNum"></span></p>
      <p><strong>Routing Number:</strong> <span id="routeNum"></span></p>
    </div>

    <a href="dashboard.html">← Back to Dashboard</a>
  </div>

  <script>
    // Load logged-in user info
    const loggedInUser = JSON.parse(localStorage.getItem("oakline_loggedInUser"));
    const allUsers = JSON.parse(localStorage.getItem("oakline_users")) || {};

    if (!loggedInUser || !allUsers[loggedInUser.username]) {
      alert("You must be logged in to open an account.");
      window.location.href = "login.html";
    }

    const userData = allUsers[loggedInUser.username];

    const form = document.getElementById("openAccountForm");
    const accNumDisplay = document.getElementById("accNum");
    const routeNumDisplay = document.getElementById("routeNum");
    const resultBox = document.getElementById("accountResult");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const accountType = document.getElementById("accountType").value;
      const initialDeposit = parseFloat(document.getElementById("initialDeposit").value);
      const fullName = document.getElementById("fullName").value.trim();
      const dob = document.getElementById("dob").value;
      const address = document.getElementById("address").value.trim();

      if (!accountType || isNaN(initialDeposit) || !fullName || !dob || !address) {
        alert("Please fill out all required fields.");
        return;
      }

      const accountNumber = "5" + Math.floor(1000000000 + Math.random() * 9000000000);
      const routingNumber = "031100209";

      const newAccount = {
        type: accountType,
        balance: initialDeposit,
        accountNumber,
        routingNumber,
        holderInfo: {
          fullName,
          dob,
          address
        },
        transactions: [{
          type: "Initial Deposit",
          amount: initialDeposit,
          date: new Date().toLocaleString(),
        }]
      };

      userData.accounts = userData.accounts || [];
      userData.accounts.push(newAccount);

      allUsers[loggedInUser.username] = userData;
      localStorage.setItem("oakline_users", JSON.stringify(allUsers));

      accNumDisplay.textContent = accountNumber;
      routeNumDisplay.textContent = routingNumber;
      resultBox.style.display = "block";

      form.reset();
    });
  </script>
</body>
</html>
