<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Open Account - Oakline Bank</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h2>Open a New Bank Account</h2>

    <form id="openAccountForm">
      <label for="fullName">Full Name:</label>
      <input type="text" id="fullName" required />

      <label for="phoneNumber">Phone Number:</label>
      <input type="tel" id="phoneNumber" required pattern="[0-9]{10,15}" />

      <label for="address">Address:</label>
      <textarea id="address" rows="2" required></textarea>

      <label for="accountType">Account Type:</label>
      <select id="accountType" required>
        <option value="">Select account type</option>
        <option value="Checking">Checking</option>
        <option value="Savings">Savings</option>
      </select>

      <label for="initialDeposit">Initial Deposit ($):</label>
      <input type="number" id="initialDeposit" min="1" required />

      <button type="submit">Create Account</button>
    </form>

    <div id="accountResult" class="result-box" style="display:none;">
      <h3>✅ Account Created Successfully</h3>
      <p><strong>Account Number:</strong> <span id="accNum"></span></p>
      <p><strong>Routing Number:</strong> <span id="routeNum"></span></p>
      <p><a href="dashboard.html">← Return to Dashboard</a></p>
    </div>
  </div>

  <script>
    const loggedInUser = localStorage.getItem("loggedInUser");
    if (!loggedInUser) {
      alert("You must be logged in to open an account.");
      window.location.href = "login.html";
    }

    const form = document.getElementById("openAccountForm");
    const accNumDisplay = document.getElementById("accNum");
    const routeNumDisplay = document.getElementById("routeNum");
    const resultBox = document.getElementById("accountResult");

    function generateAccountNumber() {
      return Math.floor(1000000000 + Math.random() * 9000000000).toString();
    }

    function generateRoutingNumber() {
      return "021000021"; // Example routing number
    }

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const fullName = document.getElementById("fullName").value.trim();
      const phoneNumber = document.getElementById("phoneNumber").value.trim();
      const address = document.getElementById("address").value.trim();
      const accountType = document.getElementById("accountType").value;
      const initialDeposit = parseFloat(document.getElementById("initialDeposit").value);

      if (!fullName || !phoneNumber || !address || !accountType || isNaN(initialDeposit) || initialDeposit <= 0) {
        alert("Please fill out all fields correctly.");
        return;
      }

      const newAccount = {
        fullName,
        phoneNumber,
        address,
        type: accountType,
        balance: initialDeposit,
        accountNumber: generateAccountNumber(),
        routingNumber: generateRoutingNumber(),
        transactions: [{
          type: "credit",
          description: "Initial Deposit",
          amount: initialDeposit,
          date: new Date().toLocaleString()
        }]
      };

      const allUsersRaw = localStorage.getItem("users");
      const allUsers = allUsersRaw ? JSON.parse(allUsersRaw) : {};

      const userData = allUsers[loggedInUser];

      if (!userData) {
        alert("User not found. Please log in again.");
        localStorage.removeItem("loggedInUser");
        window.location.href = "login.html";
        return;
      }

      userData.accounts = userData.accounts || [];
      userData.accounts.push(newAccount);

      allUsers[loggedInUser] = userData;
      localStorage.setItem("users", JSON.stringify(allUsers));

      accNumDisplay.textContent = newAccount.accountNumber;
      routeNumDisplay.textContent = newAccount.routingNumber;
      resultBox.style.display = "block";

      form.reset();
    });
  </script>
</body>
</html>
