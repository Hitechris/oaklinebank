<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Open Account | Oakline Bank</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body {
    background: #f8f9fa;
    font-family: 'Roboto', sans-serif;
  }
  .card {
    max-width: 600px;
    margin: auto;
    margin-top: 50px;
    border-radius: 10px;
  }
  h4 {
    color: #0d6efd;
  }
</style>
</head>
<body>
<div class="card p-4 shadow">
  <h4 class="mb-4 text-center">Open Your Oakline Bank Account</h4>
  <form id="openAccountForm">

    <div class="row mb-3">
      <div class="col">
        <label for="firstName" class="form-label">First Name</label>
        <input type="text" id="firstName" class="form-control" required>
      </div>
      <div class="col">
        <label for="middleName" class="form-label">Middle Name</label>
        <input type="text" id="middleName" class="form-control">
      </div>
      <div class="col">
        <label for="lastName" class="form-label">Last Name</label>
        <input type="text" id="lastName" class="form-control" required>
      </div>
    </div>

    <div class="mb-3">
      <label for="address" class="form-label">Address</label>
      <input type="text" id="address" class="form-control" required>
    </div>

    <div class="row mb-3">
      <div class="col">
        <label for="state" class="form-label">State</label>
        <select id="state" class="form-select" required>
          <option value="">Select State</option>
          <option value="Alabama">Alabama</option>
          <option value="Alaska">Alaska</option>
          <option value="Arizona">Arizona</option>
          <option value="Arkansas">Arkansas</option>
          <option value="California">California</option>
          <option value="Colorado">Colorado</option>
          <option value="Connecticut">Connecticut</option>
          <option value="Delaware">Delaware</option>
          <option value="Florida">Florida</option>
          <option value="Georgia">Georgia</option>
          <option value="Hawaii">Hawaii</option>
          <option value="Idaho">Idaho</option>
          <option value="Illinois">Illinois</option>
          <option value="Indiana">Indiana</option>
          <option value="Iowa">Iowa</option>
          <option value="Kansas">Kansas</option>
          <option value="Kentucky">Kentucky</option>
          <option value="Louisiana">Louisiana</option>
          <option value="Maine">Maine</option>
          <option value="Maryland">Maryland</option>
          <option value="Massachusetts">Massachusetts</option>
          <option value="Michigan">Michigan</option>
          <option value="Minnesota">Minnesota</option>
          <option value="Mississippi">Mississippi</option>
          <option value="Missouri">Missouri</option>
          <option value="Montana">Montana</option>
          <option value="Nebraska">Nebraska</option>
          <option value="Nevada">Nevada</option>
          <option value="New Hampshire">New Hampshire</option>
          <option value="New Jersey">New Jersey</option>
          <option value="New Mexico">New Mexico</option>
          <option value="New York">New York</option>
          <option value="North Carolina">North Carolina</option>
          <option value="North Dakota">North Dakota</option>
          <option value="Ohio">Ohio</option>
          <option value="Oklahoma">Oklahoma</option>
          <option value="Oregon">Oregon</option>
          <option value="Pennsylvania">Pennsylvania</option>
          <option value="Rhode Island">Rhode Island</option>
          <option value="South Carolina">South Carolina</option>
          <option value="South Dakota">South Dakota</option>
          <option value="Tennessee">Tennessee</option>
          <option value="Texas">Texas</option>
          <option value="Utah">Utah</option>
          <option value="Vermont">Vermont</option>
          <option value="Virginia">Virginia</option>
          <option value="Washington">Washington</option>
          <option value="West Virginia">West Virginia</option>
          <option value="Wisconsin">Wisconsin</option>
          <option value="Wyoming">Wyoming</option>
        </select>
      </div>
      <div class="col">
        <label for="city" class="form-label">City</label>
        <select id="city" class="form-select" required>
          <option value="">Select City</option>
          <!-- Cities will populate dynamically based on state -->
        </select>
      </div>
    </div>

    <div class="row mb-3">
      <div class="col">
        <label for="ssn" class="form-label">SSN</label>
        <input type="text" id="ssn" class="form-control" required>
      </div>
      <div class="col">
        <label for="dob" class="form-label">Date of Birth</label>
        <input type="date" id="dob" class="form-control" required>
      </div>
    </div>

    <div class="mb-3">
      <label for="accountType" class="form-label">Account Type</label>
      <select id="accountType" class="form-select" required>
        <option value="">Select Account Type</option>
        <option value="Checking">Checking</option>
        <option value="Savings">Savings</option>
        <option value="Both">Both</option>
      </select>
    </div>

    <button type="submit" class="btn btn-primary w-100">Open Account</button>
    <div id="formMessage" class="mt-2 text-center"></div>
  </form>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// ✅ Use your Supabase credentials
const supabaseUrl = 'https://arvuoabjhqdkxhsswybx.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFydnVvYWJqaHFka3hoc3N3eWJ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2NTQ5MzksImV4cCI6MjA3MTIzMDkzOX0.Gt1waZAhZJKS4_VGqgNQCcroGehjnxKyDUfiCRLSWB8';
const supabase = createClient(supabaseUrl, supabaseKey);

const form = document.getElementById('openAccountForm');
const msg = document.getElementById('formMessage');

const stateSelect = document.getElementById('state');
const citySelect = document.getElementById('city');

// Example cities per state (add 15–20 each)
const stateCities = {
  "California": ["Los Angeles","San Francisco","San Diego","Sacramento","San Jose","Fresno","Long Beach","Oakland","Bakersfield","Anaheim","Santa Ana","Riverside","Stockton","Irvine","Chula Vista","Fremont","San Bernardino","Modesto","Fontana","Oxnard"],
  "Texas": ["Houston","Dallas","Austin","San Antonio","Fort Worth","El Paso","Arlington","Corpus Christi","Plano","Laredo","Lubbock","Garland","Irving","Amarillo","Grand Prairie","Brownsville","Pasadena","McKinney","Mesquite","Killeen"],
  "New York": ["New York City","Buffalo","Rochester","Yonkers","Syracuse","Albany","New Rochelle","Mount Vernon","Schenectady","Utica","White Plains","Hempstead","Troy","Niagara Falls","Binghamton","Freeport","Valley Stream","Long Beach","Poughkeepsie","Middletown"],
  // ... add all other states similarly
};

// Populate city dropdown when state changes
stateSelect.addEventListener('change', () => {
  const selectedState = stateSelect.value;
  citySelect.innerHTML = '<option value="">Select City</option>';
  if(stateCities[selectedState]){
    stateCities[selectedState].forEach(city => {
      const opt = document.createElement('option');
      opt.value = city;
      opt.textContent = city;
      citySelect.appendChild(opt);
    });
  }
});

// Form submit
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  msg.innerText = '';

  // Get logged-in user
  const { data: { user }, error: userError } = await supabase.auth.getUser();
  if(userError || !user){
    msg.innerText = "Please login first.";
    msg.className = 'text-danger mt-2';
    return;
  }

  // Collect form values
  const accountData = {
    user_id: user.id,
    first_name: document.getElementById('firstName').value.trim(),
    middle_name: document.getElementById('middleName').value.trim(),
    last_name: document.getElementById('lastName').value.trim(),
    address: document.getElementById('address').value.trim(),
    state: document.getElementById('state').value,
    city: document.getElementById('city').value,
    ssn: document.getElementById('ssn').value.trim(),
    dob: document.getElementById('dob').value,
    account_type: document.getElementById('accountType').value,
    account_number: Math.floor(1000000000 + Math.random() * 9000000000).toString(), // random 10-digit
    routing_number: '075915826'
  };

  // Insert into accounts table
  const { error: insertError } = await supabase
    .from('accounts')
    .insert([accountData]);

  if(insertError){
    msg.innerText = insertError.message;
    msg.className = 'text-danger mt-2';
    return;
  }

  msg.innerText = "Account opened successfully!";
  msg.className = 'text-success mt-2';
  form.reset();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
