<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Dashboard - Oakline Bank</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
  body { font-family: 'Segoe UI', sans-serif; background-color: #f4f6f9; padding: 20px; }
  h1, h2 { color: #004080; }
  .section { background: white; border-radius: 8px; padding: 15px; margin-bottom: 30px; box-shadow: 0 0 10px rgba(0,0,0,0.05); }
  .btn-approve { background-color: #28a745; color: white; }
  .btn-approve:hover { background-color: #218838; }
  .btn-reject { background-color: #dc3545; color: white; }
  .btn-reject:hover { background-color: #c82333; }
  .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
  .logo { font-size: 24px; font-weight: 700; color: #004080; }
</style>
</head>
<body>

<div class="top-bar">
  <div class="logo">Oakline Admin Panel</div>
  <div>
    <a href="dashboard.html" class="btn btn-primary me-2">Go to Dashboard</a>
    <button class="btn btn-danger" id="logoutBtn">Logout</button>
  </div>
</div>

<div class="section">
  <h2>Total Registered Users</h2>
  <p id="totalUsersCount">Loading...</p>
</div>

<div class="section">
  <h2>Users & Balances</h2>
  <div id="usersList"></div>
</div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabaseUrl = 'https://ockhxxigrqmbuotkupfl.supabase.co';
  const supabaseKey = 'YOUR_ANON_KEY';
  const supabase = createClient(supabaseUrl, supabaseKey);

  const logoutBtn = document.getElementById('logoutBtn');
  logoutBtn.addEventListener('click', async () => {
    await supabase.auth.signOut();
    window.location.href = 'admin-login.html';
  });

  async function loadUsers() {
    const { data: users, error } = await supabase.from('profiles').select('id, email, is_admin');
    if (error) return console.error(error);
    document.getElementById('totalUsersCount').innerText = users.length;

    const usersListDiv = document.getElementById('usersList');
    usersListDiv.innerHTML = '';
    
    for (let user of users) {
      // Load user's accounts
      const { data: accounts } = await supabase.from('accounts').select('type, balance, account_number, routing_number').eq('user_id', user.id);
      const balancesHtml = accounts.map(a => `<div><strong>${a.type}:</strong> $${a.balance.toFixed(2)} (${a.account_number})</div>`).join('');
      usersListDiv.innerHTML += `
        <div class="mb-3 p-2 border rounded">
          <strong>${user.email}</strong>${user.is_admin ? ' (Admin)' : ''}<br/>
          ${balancesHtml}
        </div>
      `;
    }
  }

  loadUsers();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
