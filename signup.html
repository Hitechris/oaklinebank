<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sign Up - Oakline Bank</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f4f6f9;
    padding: 40px 20px;
  }
  .signup-box {
    max-width: 600px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  h3 {
    color: #004080;
    text-align: center;
    margin-bottom: 25px;
  }
  .btn-primary {
    background-color: #004080;
    border-color: #004080;
  }
  .btn-primary:hover {
    background-color: #003366;
  }
  .form-label { font-weight: 500; }
  .form-control, .form-select {
    border-radius: 6px;
    border: 1px solid #ccc;
    padding: 8px 12px;
  }
  #message { font-weight: 600; margin-top: 15px; text-align: center; }
</style>
</head>
<body>

<div class="signup-box">
  <h3>Create Your Oakline Bank Account</h3>

  <div class="row g-3 mb-3">
    <div class="col-md-4">
      <label for="firstName" class="form-label">First Name</label>
      <input type="text" class="form-control" id="firstName" placeholder="First Name" />
    </div>
    <div class="col-md-4">
      <label for="middleName" class="form-label">Middle Name</label>
      <input type="text" class="form-control" id="middleName" placeholder="Middle Name" />
    </div>
    <div class="col-md-4">
      <label for="lastName" class="form-label">Last Name</label>
      <input type="text" class="form-control" id="lastName" placeholder="Last Name" />
    </div>
  </div>

  <div class="mb-3">
    <label for="username" class="form-label">Username</label>
    <input type="text" class="form-control" id="username" placeholder="Choose a username" />
  </div>

  <div class="mb-3">
    <label for="email" class="form-label">Email</label>
    <input type="email" class="form-control" id="email" placeholder="Email address" />
  </div>

  <div class="mb-3">
    <label for="password" class="form-label">Password</label>
    <input type="password" class="form-control" id="password" placeholder="Password" />
  </div>

  <div class="mb-3">
    <label for="ssn" class="form-label">SSN</label>
    <input type="text" class="form-control" id="ssn" placeholder="Social Security Number" />
  </div>

  <div class="row g-3 mb-3">
    <div class="col-md-4">
      <label for="city" class="form-label">City</label>
      <input type="text" class="form-control" id="city" placeholder="City" />
    </div>
    <div class="col-md-4">
      <label for="state" class="form-label">State</label>
      <input type="text" class="form-control" id="state" placeholder="State" />
    </div>
    <div class="col-md-4">
      <label for="country" class="form-label">Country</label>
      <input type="text" class="form-control" id="country" placeholder="Country" />
    </div>
  </div>

  <div class="mb-3">
    <label for="accountType" class="form-label">Account Type</label>
    <select class="form-select" id="accountType">
      <option value="checking">Checking</option>
      <option value="savings">Savings</option>
      <option value="both">Both</option>
    </select>
  </div>

  <div class="d-grid">
    <button class="btn btn-primary" id="signupBtn">
      <i class="fas fa-user-plus me-1"></i> Sign Up
    </button>
  </div>

  <div id="message"></div>
</div>
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// Your Supabase credentials
const supabaseUrl = 'https://ockhxxigrqmbuotkupfl.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ja2h4eGlncnFtYnVvdGt1cGZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU1MTEzNzYsImV4cCI6MjA3MTA4NzM3Nn0.ZQaEXgJ2jLFFErI3eTY53cMaQrf1w19GhuGyN31WAOw';
const supabase = createClient(supabaseUrl, supabaseKey);

const signupBtn = document.getElementById("signupBtn");
const message = document.getElementById("message");

// Helper to generate random account number
function generateAccountNumber() {
  return Math.floor(1000000000 + Math.random() * 9000000000); // 10-digit
}

// Fixed routing number
const routingNumber = "075915826";

signupBtn.addEventListener("click", async () => {
  const firstName = document.getElementById("firstName").value.trim();
  const middleName = document.getElementById("middleName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const username = document.getElementById("username").value.trim();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const ssn = document.getElementById("ssn").value.trim();
  const city = document.getElementById("city").value.trim();
  const state = document.getElementById("state").value.trim();
  const country = document.getElementById("country").value.trim();
  const accountType = document.getElementById("accountType").value;

  // Basic validation
  if (!firstName || !lastName || !username || !email || !password) {
    message.innerHTML = "<span class='text-danger'>Please fill in all required fields.</span>";
    return;
  }

  try {
    // Create user in Supabase Auth
    const { data: authData, error: authError } = await supabase.auth.signUp({
      email,
      password
    });

    if (authError) throw authError;

    const userId = authData.user.id;

    // Insert into profiles
    const { error: profileError } = await supabase.from('profiles').insert([{
      id: userId,
      first_name: firstName,
      middle_name: middleName,
      last_name: lastName,
      username: username,
      email: email,
      ssn: ssn,
      city: city,
      state: state,
      country: country,
      is_admin: false
    }]);

    if (profileError) throw profileError;

    // Insert accounts
    const accountsToCreate = [];

    if (accountType === "checking" || accountType === "both") {
      accountsToCreate.push({
        user_id: userId,
        type: "checking",
        balance: 0,
        account_number: generateAccountNumber(),
        routing_number: routingNumber
      });
    }

    if (accountType === "savings" || accountType === "both") {
      accountsToCreate.push({
        user_id: userId,
        type: "savings",
        balance: 0,
        account_number: generateAccountNumber(),
        routing_number: routingNumber
      });
    }

    const { error: accountsError } = await supabase.from('accounts').insert(accountsToCreate);
    if (accountsError) throw accountsError;

    message.innerHTML = "<span class='text-success'>Sign up successful! You can now log in.</span>";

    // Clear form
    document.querySelectorAll(".signup-box input, .signup-box select").forEach(el => el.value = "");

  } catch (error) {
    console.error(error);
    message.innerHTML = `<span class='text-danger'>Error: ${error.message}</span>`;
  }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
